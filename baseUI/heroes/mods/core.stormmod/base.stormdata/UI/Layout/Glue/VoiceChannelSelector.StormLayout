<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<Desc>
    <DescFlags val="Locked"/>

    <Frame type="Frame" name="ChannelFrameTemplate">
        <Width val="51"/>
        <Height val="38"/>
        <CollapseLayout val="True"/>

        <!-- Used to properly arrange sibling frames with respect to layout collapse -->
        <Frame type="Frame" name="AnchorFrame">
            <Anchor side="Top" relative="$parent" pos="Min" offset="3"/>
            <Anchor side="Left" relative="$parent" pos="Min" offset="10"/>
            <Anchor side="Right" relative="$parent" pos="Max" offset="-10"/>
            <Anchor side="Bottom" relative="$parent" pos="Max" offset="-3"/>
        </Frame>

        <!-- Background and content -->
        <Frame type="Image" name="Background">
            <Anchor relative="$parent" offset="6"/>
            <Texture val="@UI/VoiceChat_ButtonBackground_Selected"/>
            <!-- Hover animation baseline -->
            <ColorAdjustMode val="AddSelf"/>
            <AdjustmentColor val="00ffffff"/>
        </Frame>

        <Frame type="Image" name="Icon">
            <Anchor side="Top" relative="$parent" pos="Mid" offset="0"/>
            <Anchor side="Bottom" relative="$parent" pos="Mid" offset="0"/>
            <Anchor side="Left" relative="$parent" pos=".368" offset="0"/>
            <Anchor side="Right" relative="$parent" pos=".368" offset="0"/>
            <Height val="30"/>
            <ScaleWidthToTexture val="True"/>

            <ColorAdjustMode val="{$parent/Background/@ColorAdjustMode}"/>
            <AdjustmentColor val="{$parent/Background/@AdjustmentColor}"/>
            <Color val="{$parent/Background/@Color}"/>
        </Frame>

        <Frame type="Label" name="MemberCount">
            <Anchor side="Top" relative="$parent" pos="Mid" offset="0"/>
            <Anchor side="Bottom" relative="$parent" pos="Mid" offset="0"/>
            <Anchor side="Left" relative="$parent" pos=".705" offset="0"/>
            <Anchor side="Right" relative="$parent" pos=".705" offset="0"/>

            <Text val="{$parent/VoiceChannelFrame/@ActiveMemberCount}"/>
            <ColorAdjustMode val="{$parent/Background/@ColorAdjustMode}"/>
            <AdjustmentColor val="{$parent/Background/@AdjustmentColor}"/>

            <Style val="Storm_UnitNameLabel_Disabled"/>
        </Frame>

        <!-- Hover animation -->
        <Animation name="HoverAnim">
            <Event event="OnMouseEnter" frame="ClickableFrame" action="DirectionForward,Play"/>
            <Event event="OnMouseExit" frame="ClickableFrame" action="DirectionReverse,Play"/>
            <Event event="OnMouseEnter" frame="VoiceChannelFrame" action="DirectionForward,Play"/>
            <Event event="OnMouseExit" frame="VoiceChannelFrame" action="DirectionReverse,Play"/>

            <Controller type="AdjustmentColor" frame="Background" end="Pause">
                <Key type="Curve" time="0" value="00ffffff" inout="Linear"/>
                <Key type="Curve" time="0.2" value="44ffffff" inout="Slow"/>
            </Controller>
        </Animation>

        <!-- Clickable frames -->
        <Frame type="Frame" name="ClickableFrame">
            <Anchor side="Top" relative="$parent" pos="Min" offset="3"/>
            <Anchor side="Left" relative="$parent" pos="Min" offset="4"/>
            <Anchor side="Right" relative="$parent" pos="Max" offset="-4"/>
            <Anchor side="Bottom" relative="$parent" pos="Max" offset="-3"/>
            <AcceptsMouse val="True"/>
        </Frame>

        <Frame type="VoiceChannelFrame" name="VoiceChannelFrame">
            <Anchor relative="$parent/ClickableFrame"/>
        </Frame>

        <!-- ===================================== -->
        <!-- Functional stategroups and animations -->
        <!-- ===================================== -->
        <StateGroup name="IsActive">
            <State name="Active">
                <When type="Property" frame="VoiceChannelFrame" IsActive="True"/>
                <Action type="SendEvent" event="Activate"/>
            </State>
        </StateGroup>

        <StateGroup name="Selection">
            <State name="Selected"/>
            <State name="Deselected">
                <Action type="SetProperty" frame="Background" Visible="False"/>
            </State>
            <DefaultState val="Deselected"/>
        </StateGroup>
    </Frame>

    <Frame type="Frame" name="VoiceChannelSelectorTemplate">
        <Anchor side="Right" relative="ChannelParty/AnchorFrame" pos="Max" offset="10"/>
        <Height val="40"/>

        <Frame type="Image" name="BackgroundImage">
            <Anchor side="Top" relative="$parent" pos="Min" offset="-8"/>
            <Anchor side="Left" relative="$parent" pos="Min" offset="-7"/>
            <Anchor side="Right" relative="$parent" pos="Max" offset="8"/>
            <Anchor side="Bottom" relative="$parent" pos="Max" offset="7"/>
            <Texture val="@UI/VoiceChat_Voice_Menu_Background"/>
            <TextureType val="Nineslice"/>
        </Frame>

        <!-- Channel buttons -->
        <Frame type="Frame" name="JoinLeaveFrame" template="VoiceChannelSelector/ChannelFrameTemplate">
            <Anchor side="Top" relative="$parent" pos="Mid" offset="0"/>
            <Anchor side="Bottom" relative="$parent" pos="Mid" offset="0"/>
            <Anchor side="Left" relative="$parent" pos="Min" offset="0"/>

            <Frame type="Image" name="Background">
                <Texture val="@UI/VoiceChat_ButtonBackground_Filled"/>
            </Frame>
            <Frame type="Image" name="Icon">
                <Anchor side="Left" relative="$parent" pos="Mid" offset="0"/>
                <Anchor side="Right" relative="$parent" pos="Mid" offset="0"/>
                <Texture val="@UI/VoiceChat_Voice_Menu_Enabled"/>
                <Height val="46"/>
                <Color val="FFFFFF"/>
            </Frame>
            <Frame type="Label" name="MemberCount">
                <Visible val="False"/>
            </Frame>

            <Frame type="VoiceChannelFrame" name="VoiceChannelFrame">
                <ChannelType val="Invalid"/>
            </Frame>

            <!-- Frame stategroups override -->
            <StateGroup name="Selection" requiredtoload="IS_VOICECHAT_ENABLED">
                <State name="Selected">
                    <When type="Property" frame="$VoiceChatUI" ActiveChannelType="Invalid"/>
                    <Action type="SetProperty" frame="Background" Visible="False"/>
                    <Action type="SetProperty" frame="Icon" Color="#VoiceChatColor_Inactive"/>
                </State>
                <State name="Deselected">
                    <Action type="SetProperty" frame="Background" Visible="True"/>
                </State>
            </StateGroup>
        </Frame>

        <Frame type="Frame" name="ChannelTeam" template="VoiceChannelSelector/ChannelFrameTemplate">
            <Anchor side="Top" relative="$parent" pos="Mid" offset="0"/>
            <Anchor side="Bottom" relative="$parent" pos="Mid" offset="0"/>
            <Anchor side="Left" relative="$parent/JoinLeaveFrame/AnchorFrame" pos="Max" offset="0"/>

            <!-- Content override -->
            <Frame type="Image" name="Background">
                <Color val="#VoiceChatColor_Team"/>
            </Frame>
            <Frame type="Image" name="Icon">
                <Texture val="@UI/VoiceChat_Channel_Team_Small"/>
            </Frame>
            <Frame type="Label" name="MemberCount">
                <Style val="Storm_UnitNameLabel_Team"/>
            </Frame>

            <Frame type="VoiceChannelFrame" name="VoiceChannelFrame">
            <ChannelType val="Team"/>
        </Frame>

            <StateGroup name="IsHidden">
                <State name="Hidden">
                    <When type="Property" frame="VoiceChannelFrame" IsValid="False"/>
                    <Action type="SetProperty" Visible="False"/>
                </State>
            </StateGroup>

            <!-- Deselect other frame -->
            <Animation name="ActivateAnim">
                <Event event="OnMouseDown" action="Restart,Play" frame="ClickableFrame"/>
                <Event event="Activate" action="Restart,Play"/>

                <Controller type="State" stateGroup="Selection" end="Pause">
                    <Key type="Identifier" time="0" value="Selected"/>
                </Controller>
                <Controller type="State" stateGroup="Selection" end="Pause" frame="$parent/ChannelParty">
                    <Key type="Identifier" time="0" value="Deselected"/>
                </Controller>
            </Animation>
        </Frame>

        <Frame type="Frame" name="ChannelParty" template="VoiceChannelSelector/ChannelFrameTemplate">
            <Anchor side="Top" relative="$parent" pos="Mid" offset="0"/>
            <Anchor side="Bottom" relative="$parent" pos="Mid" offset="0"/>
            <Anchor side="Left" relative="$parent/ChannelTeam/AnchorFrame" pos="Max" offset="0"/>

            <!-- Content override -->
            <Frame type="Image" name="Background">
                <Color val="#VoiceChatColor_Party"/>
            </Frame>
            <Frame type="Image" name="Icon">
                <Texture val="@UI/VoiceChat_Channel_Party_Small"/>
            </Frame>
            <Frame type="Label" name="MemberCount">
                <Style val="Storm_UnitNameLabel_Party"/>
            </Frame>

            <Frame type="VoiceChannelFrame" name="VoiceChannelFrame">
            <ChannelType val="Party"/>
        </Frame>

            <StateGroup name="IsHidden">
                <State name="Hidden">
                    <When type="Property" frame="VoiceChannelFrame" IsValid="False"/>
                    <Action type="SetProperty" Visible="False"/>
                </State>
            </StateGroup>

            <!-- Deselect other frame -->
            <Animation name="ActivateAnim">
                <Event event="OnMouseDown" action="Restart,Play" frame="ClickableFrame"/>
                <Event event="Activate" action="Restart,Play"/>

                <Controller type="State" stateGroup="Selection" end="Pause">
                    <Key type="Identifier" time="0" value="Selected"/>
                </Controller>
                <Controller type="State" stateGroup="Selection" end="Pause" frame="$parent/ChannelTeam">
                    <Key type="Identifier" time="0" value="Deselected"/>
                </Controller>
            </Animation>
    </Frame>

        <!-- General Channel selector stategroups -->
        <StateGroup name="SelectedChannel">
            <State name="Team">
                <When type="StateGroup" Selection="Selected" frame="ChannelTeam"/>
                <Action type="SetProperty" frame="JoinLeaveFrame/Background" Color="#VoiceChatColor_Team"/>
            </State>
            <State name="Party">
                <When type="StateGroup" Selection="Selected" frame="ChannelParty"/>
                <Action type="SetProperty" frame="JoinLeaveFrame/Background" Color="#VoiceChatColor_Party"/>
            </State>
        </StateGroup>

        <StateGroup name="InactiveSelectedChannel">
            <State name="Team">
                <When type="StateGroup" Selection="Selected" frame="JoinLeaveFrame"/>
                <When type="StateGroup" Selection="Selected" frame="ChannelTeam"/>
                <Action type="SetProperty" ChannelType="Team" frame="JoinLeaveFrame/VoiceChannelFrame"/>
                <Action type="SetProperty" AcceptsMouse="False" frame="ChannelTeam/VoiceChannelFrame"/>
                <Action type="SetProperty" AcceptsMouse="False" frame="ChannelParty/VoiceChannelFrame"/>
            </State>
            <State name="Party">
                <When type="StateGroup" Selection="Selected" frame="JoinLeaveFrame"/>
                <When type="StateGroup" Selection="Selected" frame="ChannelParty"/>
                <Action type="SetProperty" ChannelType="Party" frame="JoinLeaveFrame/VoiceChannelFrame"/>
                <Action type="SetProperty" AcceptsMouse="False" frame="ChannelTeam/VoiceChannelFrame"/>
                <Action type="SetProperty" AcceptsMouse="False" frame="ChannelParty/VoiceChannelFrame"/>
            </State>
        </StateGroup>
    </Frame>
</Desc>
